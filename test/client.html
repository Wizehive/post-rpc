<html>
	<head>
		<meta charset="UTF-8">
	</head>
	<body style="background: #f3f3f3;">
		<iframe id="iframe" width="100%" height="3000px" src="about:blank"></iframe>
		<script type="text/javascript">
			var source = [
				'<html>',
				'	<head>',
				'		<meta charset="UTF-8">',
				'	</head>',
				'	<body style="background: #fefefe;">',
				'		<!-- Mocha tests in the browser use unicode symbols for bullet points',
				'		so unless you want weird character bullet points, we add this. It does not',
				'		break anything with or without it. -->',
				'		<meta charset="utf-8">',
				'		<link rel="stylesheet" href="../node_modules/grunt-blanket-mocha/node_modules/mocha/mocha.css">',
				'		<!-- This is where mocha inserts the test results that are styled with the css file above -->',
				'		<div id="mocha"></div>',
				'		<!-- This is where any fixtures we need for the test will be inserted into. Naturally, we will not want to cover the mocha test results so we position this bad boy off screen. -->',
				'		<div id="test" style="position: fixed; top: 0; left: -99999px;">',
				'		</div>',
				'',
				'		<!--  <iframe width="100%" height="3000px" src="client.html" style="border: none;" sandbox="allow-scripts"></iframe>',
				'		 -->',
				'		<!-- We need to insert our testing dependencies here -->',
				'		<script src="../node_modules/chai/chai.js"><\/script>',
				'		<script src="../node_modules/sinon-chai/lib/sinon-chai.js"><\/script>',
				'		<script src="../node_modules/sinon/pkg/sinon.js"><\/script>',
				'		<script src="../node_modules/grunt-blanket-mocha/node_modules/mocha/mocha.js"><\/script>',
				'		<script src="../node_modules/grunt-blanket-mocha/node_modules/blanket/dist/mocha/blanket_mocha.js"><\/script>',
				'		<script src="../node_modules/grunt-blanket-mocha/support/mocha-blanket.js"><\/script>',
				'		<!-- We will using BDD-style assertions. See Mocha documentation for more info -->',
				'		<script>mocha.setup("bdd");<\/script>',
				'		<!-- The source file we will be testing! Do not forget the data-cover attribute so Blanket will know which file will need to be instrumented for coverage. -->',
				'		<script src="../lib/PostRPC.Client.js" data-cover><\/script>',
				'		<!-- Our test suite needs to be after the source file, of course -->',
				'		<script src="client.spec.js"><\/script>',
				'		<script>',
				'		// For Blanket add coverage in our Mocha CLI tests (node environment)',
				'		// we need to add this reporter',
				'		if (window.PHANTOMJS) {',
				'		   blanket.options("reporter", "../node_modules/grunt-blanket-mocha/support/grunt-reporter.js");',
				'		}',
				'		// If we are in in the browser/_client iframe',
				'		else {',
				'		   mocha.run();',
				'		}',
				'		<\/script>',
				'	</body>',
				'</html>',
			];

			var doc = document.getElementById('iframe').contentWindow.document;
			doc.open();
			for (var i = 0; i < source.length; i++) {
				doc.write(source[i]);
			}
			doc.close();
		</script>
		<script src="../lib/PostRPC.Server.js"></script>
		<script>
			var add = function (a, b) {
				return a + b;
			};

			var subtract = function (a, b) {
				return a - b;
			};

			var multiply = function (a, b) {
				return a * b;
			};

			var divide = function (a, b) {
				return a / b;
			};

			var digits = function (num, n) {
				return num.toPrecision(n);
			};

			var getForms = function (workspaceID) {
				return [
					{id: 70001, field1: 'A', field2: 1},
					{id: 70002, field1: 'B', field2: 2},
					{id: 70003, field1: 'C', field2: 2}
				];
			};

			var getRecords = function (formID) {
				return [
					{id: 70001, field1: 'A', field2: 1},
					{id: 70002, field1: 'B', field2: 2},
					{id: 70003, field1: 'C', field2: 2}
				];
			};

			document.addEventListener("DOMContentLoaded", function(event) {

				var server = new window.PostRPC.Server('http://localhost:5001');

				server.register('add',[['a', 'Number'], ['b', 'Number']], 'Number', add, 'Calculate the sum of two numbers');

				server.register('subtract', [['a', 'Number'], ['b', 'Number']], 'Number', subtract, 'Calculate the difference between two numbers');

				server.register('multiply', [['a', 'Number'], ['b', 'Number']], 'Number', multiply, 'Calculate the product of two numbers');

				server.register('divide', [['a', 'Number'], ['b', 'Number']], 'Number', divide, 'Calculate the divsion of two numbers');

				server.register('digits', [['num', 'Number'], ['n', 'Number']], 'Number', digits, 'Set the precicion for a number');

				server.register('getForms', [['workspaceID', 'Number']], 'Array', getForms, 'Get a list of forms for a workspace');

				server.register('getRecords', [['formID', 'Number']], 'Array', getRecords, 'Get a batch of record for a form');

				server.start();

			});
		</script>
 	</body>
</html>

